<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Install leela - leela-2.0.0</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Install leela";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> leela-2.0.0</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>User</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../user/http-interface/">Http interface</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../user/leela-query-language/">Leela query language</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Devel</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../devel/environment/">Environment</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Admin</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cassandra/">Cassandra</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../consul/">Consul</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Install leela</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#libleela">LIBLEELA</a></li>
                
            
                <li class="toctree-l3"><a href="#libleela-python">LIBLEELA-PYTHON</a></li>
                
            
                <li class="toctree-l3"><a href="#warpdrive">WARPDRIVE</a></li>
                
            
                <li class="toctree-l3"><a href="#collectd">COLLECTD</a></li>
                
            
                <li class="toctree-l3"><a href="#blackbox">BLACKBOX</a></li>
                
            
                <li class="toctree-l3"><a href="#install">INSTALL</a></li>
                
                    <li><a class="toctree-l4" href="#blackbox_1">BLACKBOX</a></li>
                
                    <li><a class="toctree-l4" href="#warpdrive_1">WARPDRIVE</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../packaging-leela/">Packaging leela</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../redis/">Redis</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">leela-2.0.0</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Admin &raquo;</li>
        
      
    
    <li>Install leela</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>This section contains information about how to install a Leela
cluster. Is is divided into two sections. The first covers how to
create the packages and the later how to install and configure the
packages.</p>
<p>This document will use <em>debian-wheezy</em> as the target platform and will
make use of the docker image that has been described in the
<a href="../../devel/environment/">environment</a> section. If you haven't
done so refer to that document to get fetch the source code and create
the docker image.</p>
<p>Now start the container. We will use it to build every single
component:</p>
<pre><code class="bash">$ docker run \
    -v .:/leela \
    --rm -i -t \
    leela/debian7-{arch} /bin/bash
</code></pre>

<p>Also this guide will install the local packages we have just
generated. You are free to use any frontend you like but as we are
using local files we find it easier using <em>gdebi</em>.</p>
<pre><code class="bash">$ apt-get install gdebi
</code></pre>

<h2 id="libleela">LIBLEELA</h2>
<p>Libleela is the client library written in C. It is the base for the
other libraries written in other languages and also contain the
poly1305aes library. You will need it to built other leela components.</p>
<pre><code class="bash">docker $ make -C /leela/pkg libleela.debian
</code></pre>

<p>It is likely to fail since there might be a few dependencies
missing. However those can be satisfied by the package manager. So
just install those that are missing and try again.</p>
<p>On success the package will be available at:</p>
<pre><code class="bash">docker $ ls -1 /leela/pkg/dist/debian7/{arch}/libleela/
libleela-dev_{major}.{minor}.{patch}-{build}_{arch}.deb
libleela_{major}.{minor}.{patch}-{build}.dsc
libleela_{major}.{minor}.{patch}-{build}.tar.gz
libleela_{major}.{minor}.{patch}-{build}_{arch}.changes
libleela_{major}.{minor}.{patch}-{build}_{arch}.deb
</code></pre>

<h2 id="libleela-python">LIBLEELA-PYTHON</h2>
<pre><code class="bash">docker $ make -C /leela/pkg libleela-python.debian
</code></pre>

<p>Likewise, some dependencies may be missing. You must solve them and
try again. If everything went right, you should have the following
packages:</p>
<pre><code class="bash">docker $ ls -1 /leela/pkg/dist/debian7/{arch}/libleela-python
libleela-python_x.y.z-b.dsc
libleela-python_x.y.z-b.tar.gz
libleela-python_x.y.z-b_{arch}.changes
libleela-python_x.y.z-b_{arch}.deb
</code></pre>

<h2 id="warpdrive">WARPDRIVE</h2>
<p>The warpdrive is the frontend of the Leela cluster. It is the service
that allows clients to store data and retrieve
information.</p>
<pre><code class="bash">docker $ make -C /leela/pkg leela-warpdrive.debian
</code></pre>

<p>Which should generate the following files:</p>
<pre><code class="bash">docker $ ls -1 /leela/pkg/dist/debian7/{arch}/leela-warpdrive/
leela-warpdrive_{major}.{minor}.{patch}-{build}.dsc
leela-warpdrive_{major}.{minor}.{patch}-{build}.tar.gz
leela-warpdrive_{major}.{minor}.{patch}-{build}_{arch}.changes
leela-warpdrive_{major}.{minor}.{patch}-{build}_{arch}.deb
</code></pre>

<h2 id="collectd">COLLECTD</h2>
<p>This package provides a collectd write plugin. With this you can send
collectd metrics to Leela.</p>
<p>As usual, lets start preparing the environment. Notice that we use
collectd from source, since it is a bit unusual to compile modules.</p>
<h2 id="blackbox">BLACKBOX</h2>
<p>This is the storage backend used by the Leela cluster. It is used
internally and it the module that gives access to the cassandra
cluster.</p>
<p>It is written in clojure which means you will need java
[we recommend using Oracle's version, specially in production]. We
will use an Ubuntu PPA repository since debian has no java packages
but openjdk.</p>
<pre><code class="bash">docker $ /leela/automation/bootstrap/clojure-bootstrap.sh
</code></pre>

<p>After this script finishes you will have java and leiningen installed
which allows us to build the package:</p>
<pre><code class="bash">docker $ make -C /leela/pkg leela-blackbox.debian
</code></pre>

<p>Afterthat you should have the following files:</p>
<pre><code class="bash">docker $ ls -1 /leela/pkg/dist/debian7/{arch}/leela-blackbox/
leela-blackbox_{major}.{minor}.{patch}-{build}.dsc
leela-blackbox_{major}.{minor}.{patch}-{build}.tar.gz
leela-blackbox_{major}.{minor}.{patch}-{build}_{arch}.changes
leela-blackbox_{major}.{minor}.{patch}-{build}_{arch}.deb
</code></pre>

<h1 id="install">INSTALL</h1>
<h2 id="blackbox_1">BLACKBOX</h2>
<p>First install the package:</p>
<pre><code class="bash">$ gdebi install leela/pkg/leela-blackbox_{major}.{minor}.{patch}-{build}_{arch}.deb
</code></pre>

<p>Then you must configure the daemon. The file that must be changed is
<code>/etc/default/leela-blackbox</code>. It is self-documented, so we just
highlight the most important options:</p>
<p>The credentials to connect to cassandra cluster:</p>
<pre><code class="bash">LEELA_BLACKBOX_USERNAME=leela
LEELA_BLACKBOX_PASSWORD=...
</code></pre>

<p>Then the cassandra cluster endpoints. Use more than one, probably the
seed nodes are a good option:</p>
<pre><code class="bash">LEELA_BLACKBOX_CASSANDRA=127.0.0.1,127.0.0.2
</code></pre>

<h2 id="warpdrive_1">WARPDRIVE</h2>
<p>First install the package:</p>
<pre><code class="bash">$ gdebi install leela/pkg/leela-warpdrive_{major}.{minor}.{patch}-{build}_{arch}.deb
</code></pre>

<p>Then you must configure the daemon. The file you must change on debian
is <code>/etc/default/leela-warpdrive</code>. It is self-documented so we just
describe the most important options.</p>
<p>The following two variables defines the username and password used to
test this <code>warpdrive</code> instance. Leela uses consul for auto-discovery
and each service has a health checker associated. If the watchdog
script fails to execute the instance does not get announced.</p>
<pre><code class="bash">LEELA_WARPDRIVE_WATCHDOG_USER=
LEELA_WARPDRIVE_WATCHDOG_PASS=
</code></pre>

<p>Another very important configuration is:</p>
<pre><code class="bash">LEELA_WARPDRIVE_ENDPOINT=
</code></pre>

<p>It defines network address of this instance that will be announced in
consul. You probably will need to change it since it defaults to
local host.</p>
<p>After the <code>/etc/default/leela-warpdrive</code> properly configured, you
may start the daemon:</p>
<pre><code class="bash">$ /etc/init.d/leela-warpdrive [start|stop|restart]
</code></pre>

<p>Notice that it depends on a number of services to work correcly. Make
sure you got these dependencies satisfied before making your cluster
available:</p>
<ul>
<li>redis [<a href="install-redis.md">install guide</a>]</li>
<li>consul [<a href="install-consul.md">install guide</a>]</li>
<li>blackbox [<a href="./#installing-blackbox">install guide</a>]</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../packaging-leela/" class="btn btn-neutral float-right" title="Packaging leela"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../consul/" class="btn btn-neutral" title="Consul"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../consul/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../packaging-leela/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
